%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% insertionsort: sort lists using a primitive insertionsort
% 
% Author:     Jonathan P. Spratte
% License:    LPPL v1.3c or later
% Copyright:  2019
% File:       insertionsort_shared.tex
%
%   This file contains macros which are identical in every version of
%   insertionsort.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% doubled definition guard >>=
\begingroup\expandafter\expandafter\expandafter\endgroup
\expandafter\ifx\csname inso@unit\endcsname\relax
\else
  \expandafter\endinput
\fi
%=<<

\newdimen\inso@unit \inso@unit=1pt

% messages
\def\inso@blankelementerror%>>=
  {%
    % ignore for the time being
  }%=<<

% define some quarks for testing and delimiting
\def\inso@qnil{\inso@qnil}
\def\inso@qmark{\inso@qmark}
\def\inso@qstop{\inso@qstop}

% define the latex equivalents of some small things
\long\def\inso@gobble#1{}
\long\def\inso@firstofone#1{#1}
\long\def\inso@firstoftwo#1#2{#1}
\long\def\inso@secondoftwo#1#2{#2}

% define some logic helper functions, those are generally faster than their
% \expandafter equivalents
\long\def\inso@fi@gobbletwo\fi#1#2{\fi}
\long\def\inso@fi@secondofthree\fi#1#2#3{\fi#2}
\long\def\inso@fi@thirdofthree\fi#1#2#3{\fi#3}
\long\def\inso@fi@gobbleuntilqstop\fi#1\inso@qstop{\fi}

% function to get the first value of the clist
\long\def\inso@getfirst#1,#2\inso@qstop{\unexpanded{#1}}
% function to gobble the first value of clist, call with trailing ',\inso@qnil'
\long\def\inso@gobblefirst#1,{\inso@gobblefirst@a,}
% function to remove a trailing ',\inso@qnil', call it with leading ','
\long\def\inso@gobblefirst@a#1,\inso@qnil{\inso@gobblefirst@b#1}
% remove the leading ',' end the \romannumeral
\def\inso@gobblefirst@b,{ }
% function to test whether argument is blank
\long\def\inso@ifblank#1%>>=
  {%
    \if\relax\detokenize\expandafter{\inso@gobble #1.}\relax
      \inso@fi@secondofthree
    \fi
    \inso@secondoftwo
  }%=<<
% redefine \inso@unit locally to expand to the true-branch of ifdimen
\def\inso@ifdimen@letunittrue{\let\inso@unit\inso@ifdimen@true}
% execute the true branch of ifdimen
\long\def\inso@ifdimen@true\inso@ifdimen@false#1#2{\endgroup#1}
% execute the false branch of ifdimen
\long\def\inso@ifdimen@false#1#2{\endgroup#2}
% non-expandable test whether TeX understands something as a dimension; #1 must
% be either a number or a dimension
\protected\long\def\inso@ifdimen#1%
  {%
    \begingroup
    \afterassignment\inso@ifdimen@letunittrue
    \inso@unit #1\inso@unit
    \inso@ifdimen@false
  }
